{% extends "base.html" %}

{% block title %}BK CB2 HESS Latest Business Applications{% endblock %}

{% block content %}
<h1 class="header">Latest Business Applications ({{ latest_ds }})</h1>
<div class="results-container" style="max-width: 900px; margin: 0 auto;">
    <table style="width: 100%; max-width: 900px; margin: 0 auto; border-collapse: collapse;">
        <thead>
            <tr style="background: #f7a440; color: #234e70;">
                <th style="padding: 0.5em 1em; text-align: left;">Application Name</th>
                <th style="padding: 0.5em 1em; text-align: left;">Business Name</th>
                <th style="padding: 0.5em 1em; text-align: left;">Business Address</th>
                <th style="padding: 0.5em 1em; text-align: left;">Postal Code</th>
                <th style="padding: 0.5em 1em; text-align: left;">Application Type</th>
                <th style="padding: 0.5em 1em; text-align: left;">Markdown</th>
                <th style="padding: 0.5em 1em; text-align: left;"></th>
            </tr>
        </thead>
        <tbody>
            {% for item in latest_items %}
            <tr style="background: #fff; border-bottom: 1px solid #eee;">
                <td style="padding: 0.5em 1em;">{{ item.application_name }}</td>
                <td style="padding: 0.5em 1em;">{{ item.business_name }}</td>
                <td style="padding: 0.5em 1em;">{{ item.business_address }}</td>
                <td style="padding: 0.5em 1em;">{{ item.postal_code }}</td>
                <td style="padding: 0.5em 1em;">{{ item.application_type }}</td>
                <td style="padding: 0.5em 1em;">
                    {% if item.markdown_path %}
                        <a href="/full/{{ item.ds }}" target="_blank">View Markdown</a>
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td style="padding: 0.5em 1em;">
                    {% if item.has_history %}
                        <button type="button" onclick="toggleHistory('{{ loop.index0 }}')">Show History</button>
                    {% endif %}
                </td>
            </tr>
            <tr id="history-{{ loop.index0 }}" style="display: none; background: #f9f9f9;">
                <td colspan="6" style="padding: 1em 2em;">
                    <div>
                        <b>Historical Agenda Items:</b>
                        <ul>
                        {% for hist in item.historical_items %}
                            <li>
                                <b>{{ hist.ds }}</b> - {{ hist.application_type }}<br>
                                <span>Business Name: {{ hist.business_name }}</span><br>
                                <span>Business Address: {{ hist.business_address }}</span><br>
                                {% if hist.markdown_path %}
                                    <a href="/full/{{ hist.ds }}" target="_blank">View Markdown</a>
                                {% endif %}
                                <span style="color: #888; font-size: 0.95em;">(match: {{ hist.match_reason }})</span>
                            </li>
                        {% else %}
                            <li>No historical items found.</li>
                        {% endfor %}
                        </ul>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<form action="/" method="get" class="back-home-form">
    <button type="submit" class="back-home-button">Back to Home</button>
</form>
{% endblock %}

{% block extra_head %}
<script>
function toggleHistory(idx) {
    var row = document.getElementById('history-' + idx);
    if (row.style.display === 'none') {
        row.style.display = '';
    } else {
        row.style.display = 'none';
    }
}
</script>
{% endblock %} 